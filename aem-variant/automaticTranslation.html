<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M19 from src/site/markdown/aem-variant/automaticTranslation.md at $dateFormat.format( $currentDate )
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M19" />
    <title>Rethinking automatic translation in AEM with LLMs – Composum AI</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.8.min.js"></script>
<meta property="og:url" content="https://ai.composum.com">
            <meta property="og:type" content="website">
            <meta property="og:title" content="Composum AI – Enhancing Content Management with AI">
            <meta property="og:description" content="Artificial intelligence for the editor in Composum Pages CMS and Adobe AEM : content creation and analysis, translation, suggestions, ...">
            <meta property="og:image" content="https://ai.composum.com/image/ComposumAILogo.jpg">
            <meta name="twitter:card" content="summary_large_image">
            <meta property="twitter:domain" content="ai.composum.com">
            <meta property="twitter:url" content="https://ai.composum.com">
            <meta name="twitter:title" content="Composum AI – Enhancing Content Management with AI">
            <meta name="twitter:description" content="Artificial intelligence for the editor in Composum Pages CMS and Adobe AEM : content creation and analysis, translation, suggestions, ...">
            <meta name="twitter:image" content="https://ai.composum.com/image/ComposumAILogo.jpg">
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left">            <h1>Composum AI
</h1></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">$i18n.getString( "site-renderer", $locale, "template.lastpublished" ): $dateValue<span class="divider">|</span>
</li>
          <li id="projectVersion">$i18n.getString( "site-renderer", $locale, "template.version" ): 2.1.0<span class="divider">|</span></li>
      <li class=""><a href="../index.html" title="Composum AI Site">Composum AI Site</a><span class="divider">/</span></li>
    <li class="active ">Rethinking automatic translation in AEM with LLMs</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://www.ist-software.com/" class="externalLink" title="IST Gmbh Dresden">IST Gmbh Dresden</a></li>
      <li class="pull-right"><a href="http://www.composum.com/" class="externalLink" title="Composum">Composum</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="../index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="../development.html" title="Development documentation"><span class="none"></span>Development documentation</a></li>
    <li><a href="../prototypes.html" title="Prototypes"><span class="none"></span>Prototypes</a></li>
    <li><a href="../aiPageTemplating.html" title="AI Page Templating"><span class="none"></span>AI Page Templating</a></li>
    <li><a href="https://www.composum.com/home/contact.html" class="externalLink" title="Contact Us"><span class="none"></span>Contact Us</a></li>
   <li class="nav-header">AEM-Variant</li>
    <li><a href="../aem-variant/index.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li><a href="../aem-variant/installation.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li><a href="../aem-variant/configuration.html" title="Configuration"><span class="none"></span>Configuration</a></li>
    <li><a href="../aem-variant/usage.html" title="Usage"><span class="none"></span>Usage</a></li>
    <li class="active"><a href="#"><span class="none"></span>Automatic Translation</a></li>
   <li class="nav-header">Composum-Variant</li>
    <li><a href="../composum-variant/index.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li><a href="../composum-variant/installation.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li><a href="../composum-variant/configuration.html" title="Configuration"><span class="none"></span>Configuration</a></li>
    <li><a href="../composum-variant/usage.html" title="Usage"><span class="none"></span>Usage</a></li>
   <li class="nav-header">References / Lists</li>
    <li><a href="../autogenerated/osgiconfigurations.html" title="OSGI Configurations"><span class="none"></span>OSGI Configurations</a></li>
    <li><a href="../autogenerated/slingcaconfigurations.html" title="Sling CA Configurations"><span class="none"></span>Sling CA Configurations</a></li>
   <li class="nav-header">Parent Project</li>
    <li><a href="../../index.html" title="Composum Platform"><span class="none"></span>Composum Platform</a></li>
   <li class="nav-header">Modules</li>
    <li><a href="../composum-ai-integration-backend/index.html" title="Composum AI::Backend"><span class="none"></span>Composum AI::Backend</a></li>
    <li><a href="../composum-ai-integration-composum/index.html" title="Composum AI::Frontend"><span class="none"></span>Composum AI::Frontend</a></li>
    <li><a href="../composum-ai/index.html" title="Composum AI::AEM"><span class="none"></span>Composum AI::AEM</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="$i18n.getString( "site-renderer", $locale, "template.builtby" ) Maven" class="poweredBy"><img class="builtBy" alt="$i18n.getString( "site-renderer", $locale, "template.builtby" ) Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<section><a id="Rethinking_automatic_translation_in_AEM_with_LLMs"></a>
<h1>Rethinking automatic translation in AEM with LLMs</h1>
<blockquote>

<p>In AEM's embrace,<br />
Composum AI weaves tongues,<br />
Seamless, swift, it blends.<br />
&#x2013; ChatGPT</p>
</blockquote><section><a id="General_idea"></a>
<h2>General idea</h2>
<p>Translating a site is often a rather large effort. Since modern LLM can both speak many languages and integrate
advanced reasoning capabilities, they can be a big help in translating a site - possibly to the point that
translating a site can amount to an automatic process where the editor only has to check the results and only
occasionally make minor changes.</p>
<p>We integrated a implementation into the Composum AI that can translate individual pages or entire sites
quickly.
It is very promising: a test translating the <a href="https://wknd.site/us/en.html" class="externalLink">WKND site</a> from English into German took
only about 10 minutes (with GPT-3.5, though),
and the translation showed little need for manual corrections. Translating into other languages like Spanish, Japanese,
Chinese, Korean seem to work nicely as well, as far as we can judge by translating the text back with
<a href="https://www.deepl.com/translator" class="externalLink">Deepl Translator</a> .</p>
<p>Also, we implement a novel process of integrating the translation transparently into the rollout process of live
copies, which allows for very easy updating of the translated sites whenever changes are made in the primary language
site.</p>
<p>It's quick and easy to try that on your own site - install it locally or on one of your test systems and check out
the result!
Please let us know what you think and how it works for you and contact us on any trouble!</p>

<div style="float: right;  margin-top: 2em;  margin-bottom: 2em; padding-left: 2em; padding-right: 2em;">
<a href="../image/ai/video/AEMAutoTranslation.mp4" target="_blank">
<figure>
<img src="../image/ai/video/AEMAutoTranslatePoster.png" alt="Composum AI for AEM automatic translation Quick Demo" width="500px" /><br />
<figcaption>
Quick demonstration of automatic translation of an AEM site with Composum AI
</figcaption>
</figure>
</a>
</div>
</section><section><a id="Advantages_of_our_approach_using_of_LLM_for_translation"></a>
<h2>Advantages of our approach using of LLM for translation</h2>
<p>While being employable for providing quick and inexpensive machine translation, LLMs like ChatGPT offer advanced
reasoning capabilities that can improve the quality of the translation:</p>
<ul>

<li>Unlike most existing machine translation solutions for AEM we collect all the texts of one page, experience fragment
or content fragment and present them together in one
translation request to an LLM (currently ChatGPT). Thus, it can take the context of the text into account and
translate it accordingly.</li>
<li>By default, the LLM is instructed to be close to the original text, preserving the original style, tone, sentiment,
and formatting. But:</li>
<li>Additional instructions can be given to influence the writing style, finetuning the translation
to the desired audience, and even to give background information about the site and the translation, if needed.
That can range from minor changes like influencing how formal to address the reader to try major modifications like
simplifying the language for a younger audience.</li>
<li>While that's not currently implemented, we make preparations so that manual corrections of translations can be
preserved when a retranslation of a modified text in the original language is done (see <a href="#difftranslation">&#x201c;Differential
re-translation&#x201d;</a> below).</li>
</ul>
<p>Or course, the full power of the <a href="usage.html">Composum AI</a> can then be used to further improve the translated texts.</p></section><section><a id="Why_we_are_using_live_copies_instead_of_language_copies"></a>
<h2>Why we are using live copies instead of language copies</h2>
<p>Our translation process differs from the translation process Adobe suggests by one important point: the translated
site(s) are live copies of the primary language, not language copies. The reason for that is: while language copies
nicely allow translating a site initially, they are more difficult to handle when you are updating the site. But
live copies are just made for that: change a page and hit &#x201c;rollout&#x201d; and the changes are transferred,
including structure changes like new components or component deletions. So our
translation process integrates transparently into the rollout process: an additional rollout configuration
translates all texts into the language configured for the rollout target during the rollout action.</p></section><section><a id="Usage"></a>
<h2>Usage</h2>
<p>There are currently three ways to trigger the translation (see below):</p>
<ul>

<li>an additional rollout configuration that transparently translates the rolled out page during rollout</li>
<li>a workflow process that can trigger a rollout with these rollout configurations for translating a page or page
tree from its blueprint</li>
<li>for experimentation: a mini UI that can be used to translate pages / page trees and roll back the translations. That
can be used to easily try out the results, but is not intended for production use.</li>
</ul>
<p>Please notice that this only works of the page to translate is a live copy of the original.</p></section><section><a id="Assumed_site_structure_and_the_translation_process"></a>
<h2>Assumed site structure and the translation process</h2>
<p>Such an automatic translation process is especially useful for sites or pages where the different language versions are
very close to each other in content and structure and mostly the language is different. So, if we require that the
other languages are live copies of their primary language, changes can be easily rolled out to the other languages, and
the automatic translation takes care of the translation of the changed / new texts.</p>
<p>A site like this could look very similar do the
<a href="https://experienceleague.adobe.com/en/docs/experience-manager-65/content/sites/administering/introduction/msm" class="externalLink">MSM site structure</a>
Adobe suggests. As an example, the WKND site the structure would look like this (just mentioning languages <code>en</code> and
<code>de</code> and countries <code>us</code> and <code>de</code> for simplicity):</p>
<ul>

<li><code>/content/wknd/language-masters/en</code> - the primary language master</li>
<li><code>/content/wknd/language-masters/de</code> is a <strong><strong>live copy</strong></strong> of the primary language master, auto-translated. This
is the difference to the normal usage of live copies, but it makes it clear where the source of a translation is and
rolling
out changes to the other languages easy.</li>
<li><code>/content/wknd/us/en</code> and <code>/content/de/de</code> are the resp. country sites, live copies of the corresponding language
masters <code>/content/wknd/language-masters/en</code> and <code>/content/wknd/language-masters/de</code>. These
are mostly unmodified copies of the language master plus some country-specific content.</li>
</ul>
<p>Of course, for multilingual sites that do not have a country-specific structure this can be appropriately simplified.</p>
<p>A similar structure is used for experience fragments (<code>/content/experience-fragments/wknd/language-masters</code>) and
content fragments (<code>/content/dam/wknd</code>). These have to be translated first - an automatic translation <code>en</code> to <code>de</code>
process also replaces links to <code>en</code> fragments with links to <code>de</code> fragments, if they exist.</p>
<p>Whenever changes are introduced into the english language master, these can be rolled out to the other languages
since these are live copies. If the translation on rollout (see below) is activated, the changed texts will be
automatically translated. Otherwise, the translation can be triggered manually with the workflows or UI.</p></section><section><a id="Translation_on_Rollout_of_Live_copies"></a>
<h2>Translation on Rollout of Live copies</h2>
<p>The translation will be automatically done on rollout under the following conditions:</p>
<ul>

<li>The live copy has either to have a path like &#x2026;/de/.. the language can be determined from, or is set to the desired
language</li>
<li>As rollout configuration there should be a configuration like the standard rollout config that updates the page,
and then (only after that!) the &#x201c;Composum AI Autotranslate&#x201d; rollout configuration.</li>
</ul>
<p>Then the pages will be transparently be translated on each rollout. Please notice that this changes the semantics of
the inheritance somewhat: if a component inherits from the blueprint that means that the texts of the component are
the AI translated texts of the blueprint, and if inheritance is cancelled the texts are manually changed.</p>
<p>Caution: When a re-translation has to be triggered e.g. because of a change in additional instructions, a rollout of a single
page will do the job and trigger the rollout configuration. However, as of 07/24, when a rollout is triggered
for a page including all subpages in AEMaaCS, only those subpages are rolled out again whose blueprint is changed,
so this might not lead to the desired result. For this case a workflow process is provided (see below).</p></section><section><a id="Triggering_translation_with_the_workflows"></a>
<h2>Triggering translation with the workflows</h2>
<p>The com.composum.ai.aem.core.impl.autotranslate.workflow.TriggerRolloutWorkflowProcess can be used in a workflow to
trigger a rollout to a given page and all subpages from their blueprints. That is, if the corresponding workflow is
triggered on a automatically translated page, it will check this page and all it's subpages whether they are live
copies and, if so, trigger a rollout from the blueprint to this page. It can be used in a workflow by adding a
workflow process step &#x201c;Composum AI Rollout To Here&#x201d; with arguments <code>{&quot;recursive&quot;:false}</code> or <code>{&quot;recursive&quot;:true}</code>,
depending on whether subpages should be rolled out.
Suggested title for the process step: &#x201c;Composum AI Rollout Tree To Here Recursively&#x201d; (if recursive=true) and
description: &#x201c;Translates the page that is given as payload from it's blueprint.
The page has to be a live copy of the page it's translated from. Configured as recursive: rolls out tree of pages.&#x201d;</p>
<p>There is also a deprecated action com.composum.ai.aem.core.impl.autotranslate.workflow.AutoTranslateWorkflowProcess
that can be used to trigger a translation of the page from a workflow. It requires that the page is set up as a live
copy of the primary language. This is deprecated in favor of triggering a rollout, if needed by
TriggerRolloutWorkflowProcess.</p>
<p>Caveat: a workflow process step is called with a workflow service user, likely workflow-process-service . Thus, we
cannot easily make sure that the workflow initiator has the rights to perform this action and modify the page
through this rollout. This has to be made sure by other means in the workflow, e.g. by
<a href="https://experienceleague.adobe.com/en/docs/experience-manager-65/content/sites/administering/operations/workflows-managing" class="externalLink">applying ACL for the specific workflow model to /var/workflow/models.</a></p></section><section><a id="Usage_of_the_Testing_UI"></a>
<h2>Usage of the Testing UI</h2>
<p>For quick experimentation and evaluation of additional instructions, we provide a very simple testing UI. The
entry point for the translation is the URL in the author server
<a href="http://localhost:4502/apps/composum-ai/components/autotranslate/list.html" class="externalLink">/apps/composum-ai/components/autotranslate/list.html</a>
It allows entering a path for a page or content / experience fragment or whole site and starting a translation process
for either that page only, or for that page and it's subpages.</p>
<p>Depending on the size of the site the translation can
take a couple of minutes - a list of triggered translations is provided, providing links to detail views with the
actual pages that were translated and the status / statistics of the translation. The detail view also provides a
button to cancel and undo the translation.</p>
<p>If enabled in OSGI, there is also an experimental UI at
<a href="http://localhost:4502/apps/composum-ai/components/autotranslate-experiments/list.html" class="externalLink">/apps/composum-ai/components/autotranslate-experiments/list.html</a>
that also provides a form to quickly roll back the translation for a subtree for quick experimentation.
This will also reenable inheritance of all properties and resources, and reset the
translated texts to the state before the automatic translation. That's not safe on production of course.</p></section><section><a id="Installation_.2F_Configuration"></a>
<h2>Installation / Configuration</h2>
<p>The preliminary implementation is integrated into the Composum AI version &gt;= 0.8.0. The POC UI has to be enabled by OSGI
configuration. If you are newly installing the Composum AI:
it needs at least <a href="configuration.html">configuration of the API key</a> for Composum AI in general; if you want to use
the POC UI you need to enable that in the &#x201c;Composum AI Autotranslate Configuration&#x201d;
(PID <code>com.composum.ai.aem.core.impl.autotranslate.AutoTranslateServiceImpl</code>) .</p>
<p>If the heuristics to determine the translated resources / properties are not sufficient for your site, you configure
exceptions in an OSGI configuration &#x201c;Composum AI Autotranslate Configuration&#x201d;
(see the <a href="../autogenerated/osgiconfigurations.html#osgi.AutoTranslateConfig">OSGI configuration reference</a> ).</p>
<p>Additionally, there is a Sling contextaware configuration &#x201c;Composum AI Automatic Translation Configuration&#x201d;
that can be used to add additional instructions how to translate the pages in the subtree the configuration applies to
(compare <a href="../autogenerated/slingcaconfigurations.html#slingca.AutoTranslateCaConfig">sling configuration reference</a> ).</p><section><a id="Translation_rules"></a>
<h3>Translation rules</h3>
<p>Since there can be different additional instructions for each page, there is the concept of a &#x201c;translation rule&#x201d;
that defines additional instructions with conditions when these are to be used. Such a rule has:</p>
<ul>

<li>an optional path pattern that has to match the path of the page</li>
<li>an optional content pattern that has to appear in the content of the page</li>
<li>the additional instructions to be added when both patterns match or no pattern is given.</li>
</ul>
<p>A common use case would be to give specific translations for certain words. That'd be done by adding a rule with the
translated word / phrase as content pattern and &#x201c;Translate XXX as YYY&#x201d; as additional instruction.
However, if you have many rules of this type you might also use translation tables with glossaries for that. You can
upload a spreadsheet (CSV or Excel file) with the word to translate in one column and the suggested translation in
another column. The AI will then be given instructions accordingly for all words that actually appear in the page
that is being translated.</p></section></section><section><a id="Notes_about_the_implementation"></a>
<h2>Notes about the implementation</h2>
<ul>

<li>To have a painless startup, the identification of properties that need translation is heuristic. Standard
attributes like
<code>jcr:title</code>,
<code>jcr:description</code>, <code>text</code>, <code>title</code>, <code>alt</code>, <code>cq:panelTitle</code>, <code>shortDescription</code>, <code>actionText</code>, <code>accessibilityLabel</code>,
<code>pretitle</code>, <code>displayPopupTitle</code>, <code>helpMessage</code> are translated if their values contain word characters. For other
properties we check that they are not paths, contain whitespace and contain some word characters. That would exclude
nonstandard properties containing single words from translation, and might lead to some false positives. For
productive usage a configuration for positive and negative exceptions would likely be recommendable. That can
currently be done with the &#x201c;Composum AI Autotranslate Configuration&#x201d;.</li>
<li>At the moment the translator can only be switched off or on, but cannot be restricted to certain users or content
areas.</li>
<li>The <a href="https://experienceleague.adobe.com/docs/experience-manager-learn/sites/multi-site-management/updating-language-copy.html" class="externalLink">standard AEM translation process</a>
uses language copies. Besides the discussed advantages of live copies, integrating into that process is a bit
difficult. The machine translation process in translation connectors is heavily geared towards translating
individual texts independently from the translated page. Ultimately this amounts to implementing the method
<a href="https://developer.adobe.com/experience-manager/reference-materials/6-5/javadoc/com/adobe/granite/translation/api/TranslationService.html#translateArray-java.lang.String:A-java.lang.String-java.lang.String-com.adobe.granite.translation.api.TranslationConstants.ContentType-java.lang.String-" class="externalLink">TranslationService.translateArray</a>
in the connector, which doesn't get any information about the translated page. Thus, most of the discussed
advantages
of LLM based translations cannot be materialized. It might be possible to use the process for human translations,
but that seems somewhat difficult, and augmenting the live copy process with transparent translation might prove to be
simpler for the editors in practice.</li>
</ul>
<p>For more details you can look at the
<a href="https://github.com/ist-dresden/composum-AI/blob/84b07ece77536f7db0034a7bb8b41ddf324b06a5/featurespecs/8AutomaticTranslation.md" class="externalLink">specification</a>
.</p></section><section><a id="Possible_extensions"></a>
<h2>Possible extensions</h2>
<p><a id="difftranslation"></a></p><section><a id="Differential_re-translation"></a>
<h3>Differential re-translation</h3>
<p>An interesting possibility where the reasoning capabilities of LLM could ease the translators work is the case where
an automatical translation was done and an editor made manual changes to that translation. If in such a case the
master language the text is changed and a simple automatical translation would be re-run, then the manual changes would
be
lost. When employing an LLM, it'd be possible to give it:</p>
<ol style="list-style-type: decimal;">

<li>the first version of the language master</li>
<li>the text that was automatically translated to</li>
<li>the text that was manually changed into</li>
<li>the new version of the language master
and ask the LLM to translate the new version and to replicate the manual changes between 2 and 3 into the new
version.
This could minimize the manual work for such cases.</li>
</ol>
<p>If you like playing around with that -
<a href="https://aigenpipeline.stoerr.net/differentialReTranslation/differentialReTranslation.html" class="externalLink">here is a small demonstration app</a>
for the idea. (It needs an OpenAI API key to work, but you can look at some English to German examples even without
that.)</p>
<blockquote>

<p>Language models weave,<br />
Context and tone they perceive,<br />
Artistry achieve.<br />
&#x2013; ChatGPT</p>
</blockquote></section></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &#169;      ${currentYear}..</p>
        </div>
      </div>
    </footer>
  </body>
</html>
