# Feature specification for a merge tool for the automatic translation process

## Background

The application integrates as an additional rollout configuration for Adobe Experience Manager (AEM) live copies,
enabling seamless automated translation of content during the rollout process.

Technically, the application enhances the AEM Multi-Site Manager (MSM) by adding an automatic translation layer for each
live copy created from the source content. When a page is rolled out, the content is automatically translated, allowing
editors to work directly with localized versions. To facilitate manual modifications, editors can break the inheritance
at the component level. Once inheritance is broken, the edited content becomes independent of further rollouts until the
inheritance is re-enabled. This ensures that manual improvements made to the translated content are preserved during
future rollouts.

For all translated properties we do save both the original text and the translated text in the component as
additional properties (whose inheritance is automatically cancelled). Those are used in reconstructing the
translated values from the source language after rolling out the page since that means the text is reset to the
source language - if that text is equivalent to the saved original text, the translation is reinstated.

- ai_original_{propertyName}: Stores the text in its original state before any AI-generated translation is applied.
- ai_translated_{propertyName}: Holds the AI-generated translation for the corresponding property.

## Basic idea

Components with enabled inheritance are automatically translated during the rollout process - which means the text
is simply overwritten with changes from the original, or just left as it is if the original wasn't changed since the
last transation. If there were, however, manual adaptions, the content is completely unchanged, without regard to
manual changes made in the source text. The translation merge tool is intended to improve this process by supporting
merging of the current text with new portions of the translated text. It displays a table of all properties that
have cancelled inheritance and changes in the source language. It has the following columns (some of which can be
hidden or are permanently hidden - that's to be decided):

- SO: original source text that was relevant for the current translation
- TO: AI translation of that original source text
- SC: current source text
- ST: AI translation of current source text
- E: an editor field for the new (merged) text
- C: current text

## Basic implementation decisions

### New properties for translation

The translation thus has now to save the following properties for cancelled inheritance:

- SO: ai_original_{propertyName} is kept - that's the value before cancellation
- TO: ai_translated_{propertyName} is kept - that's the value after cancellation
- SC: ai_new_original_{propertyName} is the value after the last rollout
- ST: ai_new_translated_{propertyName} is the translation of ai_new_original_{propertyName}

### Handling of the properties

Since the inheritance can be cancelled and reenabled at any time with out us noticing, we need to be prepared for that.
The following actions influence the saved properties:

1. If a rollout translation is done on a cancelled inheritance, only the ai_new_* properties are set / updated.
2. If a rollout translation is done on uncancelled inheritance, the ai_new_* properties are removed and the ai_*
   properties are updated.
3. If a merge is completed, we remove the ai_new_* properties but save the ai_new_original into ai_original and the
   current value into ai_translated to support future rollouts. (Possibly also set _manualChange properties.)

On translation: if there is any cancelled inheritance with changed original text, a property6  

## Functionalities of the dialog

Each row of the table described above represents one property used in the translation. Visible are the columns SC,
ST, E, C. There are the following buttons:

- '>' : copies ST to E
- '>>' : appends ST to E
- '<' : copies C to E
- '<<' : appends C to E
- '!' (magic wand) : uses AI to merge the changes.

The buttons '<' and '<<' are on top of each other in a small column between ST and E, as well as the magic wand button
'!'.
The buttons '>' and '>>' are on top of each other in a small column between E and C.

## User Workflow

To support the dialog design let's see some typical user workflows. Here are some likely use cases for the feature:

## Additional ideas

- Also create an additional tabular representation of all texts of a page as seen from the translation for debugging
  purposes.
- Somehow mark already processed fields.

### Interaction variants

- Variats for display of the editor (either text area or richtext editor):
    - Always visible
    - The "current text" field turns on click into an editor (either button or just click anywhere)
    - A dialog is opened on click - either the current text field or a button
- Save behavior:
    - save button for whole table: risky and unusual
    - save button for each row: more like the usual AEM way. Can be explicit save button for text area and the accept
      button for the richtext editor
