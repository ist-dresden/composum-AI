<!DOCTYPE html>
<html lang="en" data-sly-use.model="com.composum.ai.aem.core.impl.autotranslate.AutoTranslateMergeModel">
<head>
    <meta charset="UTF-8">
    <title>Translation Merge UI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <sly data-sly-use.clientLib="/libs/granite/sightly/templates/clientlib.html"></sly>
    <sly data-sly-call="${clientLib.css @ categories='cq.authoring.editor.core'}"></sly>
    <link rel="stylesheet" href="${resource.path}/list.css">
</head>
<body class="coral--light coral-Body foundation-layout-util-maximized-alt show-diffs hide-currenttext"
      data-page-path="${model.pagePath}">

<sly data-sly-call="${clientLib.js @ categories='coralui3,granite.ui.foundation.content'}"></sly>
<script src="${resource.path @ context='uri'}/list.js"></script>

<div class="foundation-layout-panel">
    <div class="foundation-layout-panel-bodywrapper spectrum-ready">
        <div class="foundation-layout-panel-body">
            <div class="foundation-layout-panel-content foundation-layout-form foundation-layout-form-mode-edit">
                <div class="cq-dialog-content-page">
                    <section class="coral-Form-fieldset">
                        <h2 class="coral-Form-fieldset-legend">Translation Merge Tool for page
                            <a target="_blank" href="/editor.html${model.pagePath}.html">${model.pagePath}</a>
                        </h2>
                        <span class="coral-Form-field foundation-layout-util-breakword">
                                This tool displays the texts of components where the inheritance was cancelled for manual modification, so that the translations are not automatically updated, and for which there are changes in the source page that have been noted during rollout. You can review and edit translations for modified properties below.
                                Only component properties where the inheritance has been cancelled and where
                                the blueprint was modified after cancelling inheritance or the last merging are displayed
                                - until they are saved and marked as merged.
                            </span>
                    </section>

                    <section class="coral-Form-fieldset propertytable">
                        <table is="coral-table">
                            <colgroup>
                                <col is="coral-table-column" fixedwidth>
                            </colgroup>
                            <tbody is="coral-table-body" class="propertiestable"
                                   data-sly-list.pageComponent="${model.pageComponents}">

                            <!-- Component start  -->

                            <tr is="coral-table-row" class="component-head ${pageComponent.cancelledClass}"
                                id="component-${pageComponentList.index}"
                                data-componentpath="${pageComponent.componentPath}"
                                data-cancelpropertyname="${pageComponent.cancelPropertyName}">
                                <td class="cancelcol" rowspan="${pageComponent.calculatedComponentRowspan}">
                                    <button class="cancelinheritance onlyuncancelled" is="coral-button"
                                            variant="minimal"
                                            size="M"
                                            title="Cancel Inheritance" icon="link"></button>
                                    <coral-tooltip placement="right" target=".cancelinheritance">
                                        <span slot="content">Cancels the inheritance for the whole component.</span>
                                    </coral-tooltip>
                                    <button class="reenableinheritance onlycancelled" is="coral-button"
                                            variant="minimal"
                                            title="Re-enable Inheritance" icon="linkOff"></button>
                                    <coral-tooltip placement="right" target=".reenableinheritance">
                                        <span slot="content">Re-enables the inheritance for the whole component.</span>
                                    </coral-tooltip>
                                </td>
                                <td is="coral-table-cell" colspan="6">
                                    <span class="componentName" data-sly-text="${pageComponent.componentName}"></span>
                                    <sly data-sly-test="${pageComponent.componentPathInPage}">
                                        | <span class="componentPath"
                                                data-sly-text="${pageComponent.componentPathInPage}"/>
                                    </sly>
                                    <sly data-sly-test="${pageComponent.componentTitle}">
                                        | ${pageComponent.componentTitle}
                                    </sly>
                                    <span class="linktocomponent right-aligned">
                                        <a href="${pageComponent.linkToComponent}" target="_blank"
                                           rel="noopener noreferrer">
                                            <coral-icon icon="linkOut" size="XS"
                                                        class="linktocomponent"></coral-icon></a>
                                        <coral-tooltip placement="left" target=".linktocomponent">
                                            <span slot="content">Opens the page in the editor and scrolls to this component.</span>
                                        </coral-tooltip>
                                    </span>
                                </td>
                            </tr>
                            <sly data-sly-list.property="${pageComponent.checkableProperties}">
                                <sly data-sly-test.cancelled="${pageComponent.cancelled}"></sly>

                                <!-- Property start - title row  -->

                                <tr is="coral-table-row"
                                    class="row-separator ${property.cancelledClass} ${property.processingNeededClass}"
                                    data-componentpath="${pageComponent.componentPath}"
                                    data-cancelpropertyname="${pageComponent.cancelPropertyName}"
                                    id="row-${pageComponentList.index}-${propertyList.index}">
                                    <sly data-sly-test="${cancelled}">
                                        <th is="coral-table-headercell" class="previoussrc">
                                            <span class="propertyname">${property.wrapper.propertyName}</span>
                                            Previously Translated Text
                                        </th>
                                        <coral-tooltip placement="top" target=".previoussrc" hidden>
                                            <span slot="content">The source text on which the translation currently shown in the current page was based.</span>
                                        </coral-tooltip>
                                        <th is="coral-table-headercell" class="newsrc">New Source Text</th>
                                        <coral-tooltip placement="top" target=".newsrc" hidden>
                                            <span slot="content">The new source text as it was during the last rollout.</span>
                                        </coral-tooltip>
                                        <th is="coral-table-headercell" class="srcdiffs">
                                            <span class="propertyname">${property.wrapper.propertyName}</span>
                                            Original Diffs
                                        </th>
                                        <coral-tooltip placement="top" target=".srcdiffs" hidden>
                                            <span slot="content">This shows the differences between the source text on which the translation currently shown in the current page was based and the new source text as it was during the last rollout.</span>
                                        </coral-tooltip>
                                        <th is="coral-table-headercell" class="newtrans">New Text Translation</th>
                                        <coral-tooltip placement="top" target=".newtrans" hidden>
                                            <span slot="content">The AI translation of the new source text.</span>
                                        </coral-tooltip>
                                        <th is="coral-table-headercell" class="editor">Editor for Current Text</th>
                                        <coral-tooltip placement="top" target=".editor" hidden>
                                            <span slot="content">Edit the current text on the page and save it when done.</span>
                                        </coral-tooltip>
                                        <th is="coral-table-headercell" class="currenttext">Current Text on Page</th>
                                        <coral-tooltip placement="top" target=".currenttext" hidden>
                                            <span slot="content">The current text displayed on the page, for comparison purposes.</span>
                                        </coral-tooltip>
                                    </sly>
                                    <sly data-sly-test="${!cancelled}">
                                        <th is="coral-table-headercell" class="previoussrc">
                                            <span class="propertyname">${property.wrapper.propertyName}</span>
                                            Last accepted original text
                                        </th>
                                        <coral-tooltip placement="top" target=".previoussrc" hidden>
                                            <span slot="content">The original when the translation was accepted last time</span>
                                        </coral-tooltip>
                                        <th is="coral-table-headercell" class="newsrc">Current original</th>
                                        <coral-tooltip placement="top" target=".newsrc" hidden>
                                            <span slot="content">The current original text.</span>
                                        </coral-tooltip>
                                        <th is="coral-table-headercell" class="srcdiffs">
                                            <span class="propertyname">${property.wrapper.propertyName}</span>
                                            Diffs from last accepted original
                                        </th>
                                        <coral-tooltip placement="top" target=".srcdiffs" hidden>
                                            <span slot="content">This shows the differences between the source text where the translation was last accepted
                                                and the current source text.</span>
                                        </coral-tooltip>
                                        <th is="coral-table-headercell" class="newtrans">Last accepted translation</th>
                                        <coral-tooltip placement="top" target=".newtrans" hidden>
                                            <span slot="content">The AI translation of the original where the translation was last accepted.</span>
                                        </coral-tooltip>
                                        <th is="coral-table-headercell" class="editor">The current text</th>
                                        <coral-tooltip placement="top" target=".editor" hidden>
                                            <span slot="content">The current text on the page - AI translation of the current original.</span>
                                        </coral-tooltip>
                                        <th is="coral-table-headercell" class="currenttext">
                                            <!-- Deliberately empty - no meaning here. --></th>
                                    </sly>
                                </tr>

                                <!-- Property data row  -->

                                <tr is="coral-table-row"
                                    class="property-row datarow ${property.cancelledClass} ${property.processingNeededClass}"
                                    data-componentpath="${pageComponent.componentPath}"
                                    data-cancelpropertyname="${pageComponent.cancelPropertyName}"
                                    id="datarow-${pageComponentList.index}-${propertyList.index}"
                                    data-path="${property.path}"
                                    data-propertyname="${property.wrapper.propertyName}"
                                    data-language="${model.pageLanguage}"
                                    data-os="${property.wrapper.originalCopy}"
                                    data-ot="${property.wrapper.translatedCopy}"
                                    data-ns="${property.wrapper.newOriginalCopy}"
                                    data-nt="${property.wrapper.newTranslatedCopy}"
                                    data-as="${property.wrapper.acceptedSource}"
                                    data-at="${property.wrapper.acceptedTranslation}"
                                    data-sd="${property.diffsHTML}"
                                    data-e="${property.wrapper.currentValue}"
                                    data-id="${pageComponentList.index}-${propertyList.index}"
                                    data-isrich="${property.wrapper.isRichText}">
                                    <td is="coral-table-cell" class="previoussrc diffscolor">
                                        <p data-sly-unwrap="${property.wrapper.isRichText}">
                                            ${property.diffsSrcInsertionsMarked @ context='html'}
                                        </p>
                                    </td>
                                    <td is="coral-table-cell" class="newsrc diffscolor">
                                        <p data-sly-unwrap="${property.wrapper.isRichText}">
                                            ${property.diffsDstInsertionsMarked @ context='html'}
                                        </p>
                                    </td>
                                    <td is="coral-table-cell"
                                        class="srcdiffs diffscolor">
                                        <p data-sly-unwrap="${property.wrapper.isRichText}">
                                        ${property.diffsHTML @ context='html'}</td>
                                    <td is="coral-table-cell"
                                        class="translation">
                                        <div class="translation-text">
                                            <sly data-sly-test="${cancelled}">
                                                <sly data-sly-test.isrichtext="${property.wrapper.isRichText}">
                                                    ${property.wrapper.newTranslatedCopy @ context='html'}
                                                </sly>
                                                <sly data-sly-test="${!isrichtext}">
                                                    <p>${property.wrapper.newTranslatedCopy}</p>
                                                </sly>
                                            </sly>
                                            <sly data-sly-test="${!cancelled}">
                                                <sly data-sly-test.isrichtext="${property.wrapper.isRichText}">
                                                    ${property.wrapper.acceptedTranslation @ context='html'}
                                                </sly>
                                                <sly data-sly-test="${!isrichtext}">
                                                    <p>${property.wrapper.acceptedTranslation}</p>
                                                </sly>
                                            </sly>
                                        </div>
                                    </td>
                                    <td is="coral-table-cell" class="editor">
                                        <sly data-sly-test="${cancelled}">
                                            <div class="rte-container"
                                                 data-sly-test.isrichtext="${property.wrapper.isRichText}">
                                                <div class="rte-toolbar">
                                                    <button class="rte-btn" is="coral-button" variant="minimal"
                                                            title="Bold" icon="textBold"
                                                            data-command="bold"></button>
                                                    <!-- <coral-tooltip placement="top" target=".rte-btn[title='Bold']">
                                                        <span slot="content">Make the text bold.</span>
                                                    </coral-tooltip> -->
                                                    <button is="coral-button" variant="minimal" title="Italic"
                                                            icon="textItalic"
                                                            data-command="italic"></button>
                                                    <!-- <coral-tooltip placement="top" target=".rte-btn[title='Italic']">
                                                        <span slot="content">Make the text italic.</span>
                                                    </coral-tooltip> -->
                                                    <button is="coral-button" variant="minimal" title="Underline"
                                                            icon="textUnderline"
                                                            data-command="underline"></button>
                                                    <!-- <coral-tooltip placement="top" target=".rte-btn[title='Underline']">
                                                        <span slot="content">Underline the text.</span>
                                                    </coral-tooltip> -->
                                                    <button is="coral-button" variant="minimal" title="Edit Link"
                                                            icon="link" class="edit-link-btn"></button>
                                                    <button is="coral-button" variant="minimal" title="Remove Link"
                                                            icon="unlink" class="remove-link-btn"></button>
                                                    <button is="coral-button" variant="minimal" title="Bullet List"
                                                            icon="textBulleted"
                                                            data-command="insertUnorderedList"></button>
                                                    <!-- <coral-tooltip placement="top"
                                                                   target=".rte-btn[title='Bullet List']">
                                                        <span slot="content">Create a bullet list.</span>
                                                    </coral-tooltip> -->
                                                    <button is="coral-button" variant="minimal" title="Numbered List"
                                                            icon="textNumbered"
                                                            data-command="insertOrderedList"></button>
                                                    <!-- <coral-tooltip placement="top"
                                                                   target=".rte-btn[title='Numbered List']">
                                                        <span slot="content">Create a numbered list.</span>
                                                    </coral-tooltip> -->
                                                </div>
                                                <div class="rte-editor" contenteditable="true">
                                                    ${property.wrapper.currentValue @ context='html'}
                                                </div>
                                            </div>
                                            <div class="text-container" data-sly-test="${!isrichtext}">
                                                <textarea class="text-editor" rows="3"
                                                          data-sly-text="${property.wrapper.currentValue}"></textarea>
                                            </div>
                                        </sly>
                                        <sly data-sly-test="${!cancelled}">
                                            <sly data-sly-test.isrichtext="${property.wrapper.isRichText}">
                                                ${property.wrapper.currentValue @ context='html'}
                                            </sly>
                                            <sly data-sly-test="${!isrichtext}">
                                                <p>${property.wrapper.currentValue}</p>
                                            </sly>
                                        </sly>
                                    </td>
                                    <td is="coral-table-cell" class="currenttext">
                                        <div class="current-text" data-sly-test="${cancelled}">
                                            <p data-sly-unwrap="${property.wrapper.isRichText}">
                                                ${property.wrapper.currentValue @ context='html'}
                                            </p>
                                        </div>
                                    </td>
                                </tr>

                                <!-- Action buttons  -->

                                <tr is="coral-table-row"
                                    class="property-row actionrow ${property.cancelledClass} ${property.processingNeededClass}"
                                    data-componentpath="${pageComponent.componentPath}"
                                    data-cancelpropertyname="${pageComponent.cancelPropertyName}"
                                    id="actionrow-${pageComponentList.index}-${propertyList.index}">
                                    <td is="coral-table-cell" class="previoussrc diffscolor">
                                    </td>
                                    <td is="coral-table-cell" class="newsrc diffscolor">
                                    </td>
                                    <td is="coral-table-cell" class="srcdiffs diffscolor"></td>
                                    <td is="coral-table-cell" class="newtrans">
                                        <div class="row-actions" data-sly-test="${cancelled}">
                                            <button is="coral-button" variant="secondary"
                                                    class="intelligent-merge onlycancelled">AI Merge
                                                <coral-wait size="S" class="spinner"></coral-wait>
                                            </button>
                                            <coral-tooltip placement="right" target=".intelligent-merge">
                                                    <span slot="content">
                                                        This takes the current text, inspects the differences between the previously translated source text and the new source text and incorporates the corresponding changes from the new text translation. Thus this tries to keep manual changes that have been done to the current text of the component as much as possible.</span>
                                            </coral-tooltip>
                                            <button is="coral-button" variant="secondary"
                                                    class="copy-to-editor">Copy to Editor
                                            </button>
                                            <coral-tooltip placement="right" target=".copy-to-editor">
                                                <span slot="content">Copy the new translation as it is to the editor, replacing the editor content.</span>
                                            </coral-tooltip>
                                            <!-- <button is="coral-button" variant="secondary"
                                                    class="append-to-editor">Append to Editor
                                            </button> -->
                                        </div>
                                    </td>
                                    <td is="coral-table-cell" class="editor">
                                        <div class="editor-actions">
                                            <sly data-sly-test="${cancelled}">
                                                <button is="coral-button" variant="primary" class="save-editor">
                                                    Save and Finish
                                                    <coral-wait size="S" class="spinner"></coral-wait>
                                                </button>
                                                <coral-tooltip placement="right" target=".save-editor">
                                                    <span slot="content">Save the changes made in the editor and marks this text as merged - that is it will not be shown again in this tool until there are further changes to the source text rolled out.</span>
                                                </coral-tooltip>
                                                <button is="coral-button" variant="secondary" class="reset-editor">
                                                    Reset
                                                </button>
                                                <coral-tooltip placement="right" target=".reset-editor">
                                                    <span slot="content">Resets the editor to the current text on the page.</span>
                                                </coral-tooltip>
                                            </sly>
                                            <sly data-sly-test="${!cancelled}">
                                                <button is="coral-button" variant="secondary"
                                                        class="accept-translation">
                                                    Accept translation
                                                </button>
                                                <coral-tooltip placement="right" target=".accept-translation">
                                                    <span slot="content">Saves that the translation was accepted as it is. Alternative: cancel component and then edit.</span>
                                                </coral-tooltip>
                                            </sly>
                                        </div>
                                    </td>
                                    <td is="coral-table-cell" class="currenttext">
                                    </td>
                                </tr>

                                <!-- Property end, component end  -->

                            </sly>
                            </tbody>
                        </table>
                    </section>

                    <sly data-sly-use.bottombar="${'bottombar-template.html'}"
                         data-sly-call="${bottombar.bottombarTemplate @ model=model}"></sly>
                </div>
            </div>
        </div>
    </div>
</div>

<sly data-sly-include="link-modal.html"></sly>

<div id="path-chooser-content">
</div>

</body>
