#!/usr/bin/env bash
echo This generates several documentation files using AI
echo It uses aigenpipeline https://aigenpipeline.stoerr.net/

DIR=src/site/markdown/autogenerated
if [ ! -d "$DIR" ]; then
  echo "Directory $DIR does not exist - not running in project root?"
  exit 1
fi

# for each file that contains an @ObjectClassDefinition do a grep for @ObjectClassDefinition|@AttributeDefinition
# and write the result into $DIR/osgiconfigurations.raw
for file in $(fgrep -l -R --include="*.java" '@ObjectClassDefinition'); do
  mdname=$DIR/parts/osgi.$(basename $file .java).md.part
  aigenpipeline -p $DIR/osgiconfigurations.prompt $file -o $mdname
done

(
  echo "# OSGi Configurations"
  echo
  cat $DIR/parts/osgi.*.md.part | fgrep -v AIGenVersion
) > $DIR/osgiconfigurations.md

#same thing for @Configuration and @Property

for file in $(fgrep -l -R --include="*.java" '@Configuration'); do
  mdname=$DIR/parts/slingca.$(basename $file .java).md.part
  aigenpipeline -p $DIR/slingcaconfigurations.prompt $file -o $mdname
done

(
  echo "# Sling Context Aware Configurations"
  echo
  cat $DIR/parts/slingca.*.md.part | fgrep -v AIGenVersion
) > $DIR/slingcaconfigurations.md
